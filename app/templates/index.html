{% extends "base.html" %}

{% block section %}
{% set icon_base = "https://cdn.jsdelivr.net/npm/cryptocurrency-icons@0.17.1/svg/color/" %}
{% set icon_map = {
    'btc': 'btc.svg', 'eth': 'eth.svg', 'usdt': 'usdt.svg', 'bnb': 'bnb.svg',
    'ada': 'ada.svg', 'xrp': 'xrp.svg', 'xrp': 'xrp.svg', 'sol': 'sol.svg', 'dot': 'dot.svg',
    'ltc': 'ltc.svg', 'doge': 'doge.svg', 'eur': 'eur.svg', 'usd': 'usd.svg'
} %}

<section class="main-content-wrapper">
    <div class="card-header-section">
        <h2>Historial de Movimientos</h2>
        <a href="/download_pdf" class="btn btn-download-pdf">
            <i class="bi bi-file-earmark-pdf"></i>
            <span>Descargar Informe PDF</span>
        </a>
    </div>

    {% if data %}
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Moneda Usada</th>
                    <th>Cantidad</th>
                    <th>Moneda Comprada</th>
                    <th>Cantidad Compra</th>
                    <th>P.U</th>
                </tr>
            </thead>
            <tbody>
                {% for mov in data %}
                <tr>
                    <td>{{ mov['Fecha'] }}</td>
                    <td>{{ mov['Hora'] }}</td>
                    <td class="currency-cell">
                        {% set from_symbol = mov['Moneda_From']|lower %}
                        {% if icon_map[from_symbol] %}<img src="{{ icon_base ~ icon_map[from_symbol] }}" alt="{{ from_symbol }}" class="crypto-icon">{% endif %}
                        <span>{{ mov['Moneda_From'] }}</span>
                    </td>
                    <td class="numeric-value">{{ '%.2f' | format(mov['Cantidad_From']) }}</td>
                    <td class="currency-cell">
                        {% set to_symbol = mov['Moneda_To']|lower %}
                        {% if icon_map[to_symbol] %}<img src="{{ icon_base ~ icon_map[to_symbol] }}" alt="{{ to_symbol }}" class="crypto-icon">{% endif %}
                        <span>{{ mov['Moneda_To'] }}</span>
                    </td>
                    <td class="numeric-value">{{ '%.6f' | format(mov['Cantidad_To'] | float) }}</td>
                    <td class="numeric-value">{{ '{:,.5f}'.format(mov['Precio_unitario'] | float).replace(',', '.') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state-card">
        <p class="empty-state-message">Aún no hay movimientos registrados. ¡Comienza a operar para ver tu historial aquí!</p>
        <a href="/purchase" class="btn btn-primary">Realizar primera operación</a>
    </div>
    {% endif %}
</section>
{% endblock %}